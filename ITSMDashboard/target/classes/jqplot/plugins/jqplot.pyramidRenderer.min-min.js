(function(l){if(l.jqplot.PyramidAxisRenderer===undefined){l.ajax({url:l.jqplot.pluginLocation+"jqplot.pyramidAxisRenderer.js",dataType:"script",async:false})}if(l.jqplot.PyramidGridRenderer===undefined){l.ajax({url:l.jqplot.pluginLocation+"jqplot.pyramidGridRenderer.js",dataType:"script",async:false})}l.jqplot.PyramidRenderer=function(){l.jqplot.LineRenderer.call(this)};l.jqplot.PyramidRenderer.prototype=new l.jqplot.LineRenderer();l.jqplot.PyramidRenderer.prototype.constructor=l.jqplot.PyramidRenderer;l.jqplot.PyramidRenderer.prototype.init=function(c,f){c=c||{};this._type="pyramid";this.barPadding=10;this.barWidth=null;this.fill=true;this.highlightMouseOver=true;this.highlightMouseDown=false;this.highlightColors=[];this.highlightThreshold=2;this.synchronizeHighlight=false;this.offsetBars=false;if(c.highlightMouseDown&&c.highlightMouseOver==null){c.highlightMouseOver=false}this.side="right";l.extend(true,this,c);if(this.side==="left"){this._highlightThreshold=[[-this.highlightThreshold,0],[-this.highlightThreshold,0],[0,0],[0,0]]}else{this._highlightThreshold=[[0,0],[0,0],[this.highlightThreshold,0],[this.highlightThreshold,0]]}this.renderer.options=c;this._highlightedPoint=null;this._dataColors=[];this._barPoints=[];this.fillAxis="y";this._primaryAxis="_yaxis";this._xnudge=0;var p={lineJoin:"miter",lineCap:"butt",fill:this.fill,fillRect:this.fill,isarc:false,strokeStyle:this.color,fillStyle:this.color,closePath:this.fill,lineWidth:this.lineWidth};this.renderer.shapeRenderer.init(p);var a=c.shadowOffset;if(a==null){if(this.lineWidth>2.5){a=1.25*(1+(Math.atan((this.lineWidth/2.5))/0.785398163-1)*0.6)}else{a=1.25*Math.atan((this.lineWidth/2.5))/0.785398163}}var d={lineJoin:"miter",lineCap:"butt",fill:this.fill,fillRect:this.fill,isarc:false,angle:this.shadowAngle,offset:a,alpha:this.shadowAlpha,depth:this.shadowDepth,closePath:this.fill,lineWidth:this.lineWidth};this.renderer.shadowRenderer.init(d);f.postDrawHooks.addOnce(i);f.eventListenerHooks.addOnce("jqplotMouseMove",j);if(this.side==="left"){for(var b=0,e=this.data.length;b<e;b++){this.data[b][1]=-Math.abs(this.data[b][1])}}};l.jqplot.PyramidRenderer.prototype.setGridData=function(f){var c=this._xaxis.series_u2p;var q=this._yaxis.series_u2p;var b=this._plotData;var r=this._prevPlotData;this.gridData=[];this._prevGridData=[];var e=b.length;var a=false;var d;for(d=0;d<e;d++){if(b[d][1]<0){this.side="left"}}if(this._yaxis.name==="yMidAxis"&&this.side==="right"){this._xnudge=this._xaxis.max/2000;a=true}for(d=0;d<e;d++){if(b[d][0]!=null&&b[d][1]!=null){this.gridData.push([c(b[d][1]),q(b[d][0])])}else{if(b[d][0]==null){this.gridData.push([c(b[d][1]),null])}else{if(b[d][1]==null){this.gridData.push(null,[q(b[d][0])])}}}if(b[d][1]===0&&a){this.gridData[d][0]=c(this._xnudge)}}};l.jqplot.PyramidRenderer.prototype.makeGridData=function(a,f){var b=this._xaxis.series_u2p;var q=this._yaxis.series_u2p;var c=[];var e=a.length;var r=false;var d;for(d=0;d<e;d++){if(a[d][1]<0){this.side="left"}}if(this._yaxis.name==="yMidAxis"&&this.side==="right"){this._xnudge=this._xaxis.max/2000;r=true}for(d=0;d<e;d++){if(a[d][0]!=null&&a[d][1]!=null){c.push([b(a[d][1]),q(a[d][0])])}else{if(a[d][0]==null){c.push([b(a[d][1]),null])}else{if(a[d][1]==null){c.push([null,q(a[d][0])])}}}if(a[d][1]===0&&r){c[d][0]=b(this._xnudge)}}return c};l.jqplot.PyramidRenderer.prototype.setBarWidth=function(){var r;var u=0;var t=0;var e=this[this._primaryAxis];var a,f,c;u=e.max-e.min;var d=e.numberTicks;var s=(d-1)/2;var b=(this.barPadding===0)?1:0;if(e.name=="xaxis"||e.name=="x2axis"){this.barWidth=(e._offsets.max-e._offsets.min)/u-this.barPadding+b}else{if(this.fill){this.barWidth=(e._offsets.min-e._offsets.max)/u-this.barPadding+b}else{this.barWidth=(e._offsets.min-e._offsets.max)/u}}};l.jqplot.PyramidRenderer.prototype.draw=function(X,f,ae){var R;var Q=l.extend({},ae);var aa=(Q.shadow!=undefined)?Q.shadow:this.shadow;var b=(Q.showLine!=undefined)?Q.showLine:this.showLine;var W=(Q.fill!=undefined)?Q.fill:this.fill;var S=this._xaxis.series_u2p;var N=this._yaxis.series_u2p;var c,w;this._dataColors=[];this._barPoints=[];if(this.renderer.options.barWidth==null){this.renderer.setBarWidth.call(this)}var U=[],T,P;if(b){var Y=new l.jqplot.ColorGenerator(this.negativeSeriesColors);var O=new l.jqplot.ColorGenerator(this.seriesColors);var e=Y.get(this.index);if(!this.useNegativeColors){e=Q.fillStyle}var ab=Q.fillStyle;var ac;var a=this._xaxis.series_u2p(this._xnudge);var af=this._yaxis.series_u2p(this._yaxis.min);var ad=this._yaxis.series_u2p(this._yaxis.max);var M=this.barWidth;var d=M/2;var U=[];var V=this.offsetBars?d:0;for(var R=0,Z=f.length;R<Z;R++){if(this.data[R][0]==null){continue}ac=f[R][1];if(this._plotData[R][1]<0){if(this.varyBarColor&&!this._stack){if(this.useNegativeColors){Q.fillStyle=Y.next()}else{Q.fillStyle=O.next()}}}else{if(this.varyBarColor&&!this._stack){Q.fillStyle=O.next()}else{Q.fillStyle=ab}}if(this.fill){if(this._plotData[R][1]>=0){T=f[R][0]-a;P=this.barWidth;U=[a,ac-d-V,T,P]}else{T=a-f[R][0];P=this.barWidth;U=[f[R][0],ac-d-V,T,P]}this._barPoints.push([[U[0],U[1]+P],[U[0],U[1]],[U[0]+T,U[1]],[U[0]+T,U[1]+P]]);if(aa){this.renderer.shadowRenderer.draw(X,U)}var ag=Q.fillStyle||this.color;this._dataColors.push(ag);this.renderer.shapeRenderer.draw(X,U,Q)}else{if(R===0){U=[[a,af],[f[R][0],af],[f[R][0],f[R][1]-d-V]]}else{if(R<Z-1){U=U.concat([[f[R-1][0],f[R-1][1]-d-V],[f[R][0],f[R][1]+d-V],[f[R][0],f[R][1]-d-V]])}else{U=U.concat([[f[R-1][0],f[R-1][1]-d-V],[f[R][0],f[R][1]+d-V],[f[R][0],ad],[a,ad]]);if(aa){this.renderer.shadowRenderer.draw(X,U)}var ag=Q.fillStyle||this.color;this._dataColors.push(ag);this.renderer.shapeRenderer.draw(X,U,Q)}}}}}if(this.highlightColors.length==0){this.highlightColors=l.jqplot.computeHighlightColors(this._dataColors)}else{if(typeof(this.highlightColors)=="string"){this.highlightColors=[];for(var R=0;R<this._dataColors.length;R++){this.highlightColors.push(this.highlightColors)}}}};function g(a,b,d){d=d||{};d.axesDefaults=d.axesDefaults||{};d.grid=d.grid||{};d.legend=d.legend||{};d.seriesDefaults=d.seriesDefaults||{};var e=false;if(d.seriesDefaults.renderer===l.jqplot.PyramidRenderer){e=true}else{if(d.series){for(var c=0;c<d.series.length;c++){if(d.series[c].renderer===l.jqplot.PyramidRenderer){e=true}}}}if(e){d.axesDefaults.renderer=l.jqplot.PyramidAxisRenderer;d.grid.renderer=l.jqplot.PyramidGridRenderer;d.seriesDefaults.pointLabels={show:false}}}function i(){if(this.plugins.pyramidRenderer&&this.plugins.pyramidRenderer.highlightCanvas){this.plugins.pyramidRenderer.highlightCanvas.resetCanvas();this.plugins.pyramidRenderer.highlightCanvas=null}this.plugins.pyramidRenderer={highlightedSeriesIndex:null};this.plugins.pyramidRenderer.highlightCanvas=new l.jqplot.GenericCanvas();this.eventCanvas._elem.before(this.plugins.pyramidRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-pyramidRenderer-highlight-canvas",this._plotDimensions,this));this.plugins.pyramidRenderer.highlightCanvas.setContext();this.eventCanvas._elem.bind("mouseleave",{plot:this},function(a){k(a.data.plot)})}function h(a,b,d,e){var f=a.series[b];var n=a.plugins.pyramidRenderer.highlightCanvas;n._ctx.clearRect(0,0,n._ctx.canvas.width,n._ctx.canvas.height);f._highlightedPoint=d;a.plugins.pyramidRenderer.highlightedSeriesIndex=b;var c={fillStyle:f.highlightColors[d],fillRect:false};f.renderer.shapeRenderer.draw(n._ctx,e,c);if(f.synchronizeHighlight!==false&&a.series.length>=f.synchronizeHighlight&&f.synchronizeHighlight!==b){f=a.series[f.synchronizeHighlight];c={fillStyle:f.highlightColors[d],fillRect:false};f.renderer.shapeRenderer.draw(n._ctx,f._barPoints[d],c)}n=null}function k(a){var c=a.plugins.pyramidRenderer.highlightCanvas;c._ctx.clearRect(0,0,c._ctx.canvas.width,c._ctx.canvas.height);for(var b=0;b<a.series.length;b++){a.series[b]._highlightedPoint=null}a.plugins.pyramidRenderer.highlightedSeriesIndex=null;a.target.trigger("jqplotDataUnhighlight");c=null}function j(c,d,p,a,b){if(a){var e=[a.seriesIndex,a.pointIndex,a.data];var f=jQuery.Event("jqplotDataMouseOver");f.pageX=c.pageX;f.pageY=c.pageY;b.target.trigger(f,e);if(b.series[e[0]].highlightMouseOver&&!(e[0]==b.plugins.pyramidRenderer.highlightedSeriesIndex&&e[1]==b.series[e[0]]._highlightedPoint)){var o=jQuery.Event("jqplotDataHighlight");o.which=c.which;o.pageX=c.pageX;o.pageY=c.pageY;b.target.trigger(o,e);h(b,a.seriesIndex,a.pointIndex,a.points)}}else{if(a==null){k(b)}}}l.jqplot.preInitHooks.push(g)})(jQuery);