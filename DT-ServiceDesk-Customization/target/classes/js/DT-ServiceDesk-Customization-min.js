AJS.toInit(function(){var b=AJS.$("#baseURL").val();AJS.$("#request-types-table tbody tr").live("mouseover",function(){AJS.$(this).css("background-color","#E8E8E8")});AJS.$("#request-types-table tbody tr").live("mouseout",function(){AJS.$(this).css("background-color","white")});AJS.$("#request-types-table tbody tr  .tdcls").live("mouseover",function(){if(AJS.$(this).children(".icons").length===0){AJS.$(this).append('<div class="icons"></div>')}AJS.$(this).children(".icons").append('<a style="float:right" class="aui-icon-small aui-iconfont-edit"/>');AJS.$(this).addClass("tdhover")});AJS.$("#request-types-table tbody tr .tdcls").live("mouseout",function(){AJS.$(this).children(".icons").remove();AJS.$(this).removeClass("tdhover")});AJS.$(".request-type-icon").live("click",function(){AJS.dialog2("#icons-popup").show()});AJS.$(".request-type-icon-add").live("click",function(f){AJS.dialog2("#icons-add-popup").show()});AJS.$("#dialog-close-button").click(function(f){f.preventDefault();AJS.dialog2("#group-popup").hide()});AJS.$("#icons-add-close-button").click(function(f){f.preventDefault();AJS.dialog2("#icons-add-popup").hide()});AJS.$("#icons-close-button").click(function(f){f.preventDefault();AJS.dialog2("#icons-popup").hide()});AJS.$(".vp-icons-chooser > .vp-rq-icon").live("click",function(){AJS.$("#selIconHidden").val(AJS.$(this).attr("class"));AJS.$(this).addClass("selected")});AJS.$(".vp-icons-chooser-add > .vp-rq-icon").live("click",function(){AJS.$("#selAddHidden").val(AJS.$(this).attr("class"));AJS.$(this).addClass("selected")});AJS.$("#addGroup").live("click",function(g){var f=AJS.$("#addNewGroup").val();if(f!==null&&d(f)){AJS.$("#groups").append('<option value="'+f+'"   title="'+f+'">'+f+"</option>");AJS.$("#groups").val(f);AJS.$("#groups").auiSelect2()}else{}g.preventDefault();AJS.dialog2("#group-popup").hide()});AJS.$(".selectIcon").live("click",function(g){var f=AJS.$("#selIconHidden").val();AJS.$(".aui-restfultable-focused td:first-child").find("div").removeClass();AJS.$(".aui-restfultable-focused td:first-child").find("div").addClass(f);AJS.$(".aui-restfultable-focused td:first-child").find("div").removeClass("selected");AJS.$(".aui-restfultable-focused td:first-child").find("input:hidden").val(f);g.preventDefault();AJS.dialog2("#icons-popup").hide()});AJS.$(".selectIconadd").live("click",function(g){var f=AJS.$("#selAddHidden").val();AJS.$(".request-type-icon-add").find("div").removeClass();AJS.$(".request-type-icon-add").find("div").addClass(f);AJS.$(".request-type-icon-add").find("div").removeClass("selected");AJS.$(".request-type-icon-add").find("input:hidden").val(f);g.preventDefault();AJS.dialog2("#icons-add-popup").hide()});AJS.$(".addNewGrpBtn").live("click",function(){AJS.dialog2("#group-popup").show()});AJS.$.ajax({url:b+"/rest/dealertracks/servicedeskrest/1.0/ServiceDeskField/getServiceDeskFields.json",type:"GET",contentType:"application/json",data:{},success:function(e){var f=[];AJS.$("#request-types-table tbody tr").remove();AJS.$.each(e,function(h,g){AJS.$('<tr id="'+g.serviceID+'" class="aui-restfultable-editrow aui-restfultable-row "></tr>').html('<td class="tdcls request-type-icon"><span class="aui-restfultable-hovercell" data-field-name="icon"><input type="hidden" name="requestTypeIcon" id="requestTypeIcon" value="'+g.icon+'"><div aria-hidden="true" class="'+g.icon+'"></div></span></td><td class="tdcls"><div class="tdwrapcls" title="'+g.item+'">'+g.item+'</div><div class="icons"></div></td><td class="tdcls"><div class="tdwrapcls" title="'+g.groups+'">'+g.groups+'</div></td><td class="tdcls"><div class="tdurlWrapcls" title="'+g.url+'">'+g.url+'</td><td class="tdcls">'+g.servicedesks+'</div></td><td colspan="2"><input type="hidden" value="'+g.serviceID+'"/><a  href="javascript:void(0);" class="delBtn aui-button aui-button-link aui-restfultable-delete" original-title="">Delete</a></td>').appendTo("#request-types-table");var k=g.groups;if(k.indexOf(",")>=0){var j=k.split(",");AJS.$.each(j,function(i,l){if(AJS.$.inArray(l,f)===-1){f.push(l)}})}else{if(AJS.$.inArray(g.groups,f)===-1){f.push(k)}}});AJS.$.each(f,function(h,i){if(i.indexOf(",")===-1){AJS.$("#groups").append('<option value="'+i+'"  title="'+i+'">'+i+"</option>  ")}})}});AJS.$("#fileUpload").on("change",function(){var h=AJS.$(this)[0].value;var g=h.substring(h.lastIndexOf(".")+1).toLowerCase();if(g=="gif"||g=="png"||g=="jpg"||g=="jpeg"){if(typeof(FileReader)!="undefined"){var f=AJS.$("#image-holder");f.empty();var e=new FileReader();e.onload=function(i){AJS.$("<img></img>",{src:i.target.result,"class":"thumb-image",style:"width:85px;height:80px",}).appendTo(f)};f.show();e.readAsDataURL(AJS.$(this)[0].files[0])}else{}}else{}});AJS.$("#request-types-table tbody tr  .tdcls").live("click",function(){var l=AJS.$(this).closest("tr");var k=l.hasClass("aui-restfultable-focused");AJS.$("#request-types-table tbody tr").removeClass("aui-restfultable-focused");if(!k){l.addClass("aui-restfultable-focused")}var e=[];AJS.$(this).closest("tr").find("td").each(function(){var n="";AJS.$(this).find("select").each(function(){n=AJS.$(this).val()});if(n===""){AJS.$(this).find("input").each(function(){if(AJS.$(this).is(":text")){n=AJS.$(this).val()}if(AJS.$(this).is(":hidden")){n=AJS.$(this).val()}})}if(n===""){n=AJS.$(this).text()}e.push(n)});var f=[];var g=AJS.$.parseJSON(AJS.$.ajax({url:b+"/rest/dealertracks/servicedeskrest/1.0/ServiceDeskField/getServiceDeskGroups.json?servicedeskName=",type:"GET",contentType:"application/json",async:false}).responseText);AJS.$.each(g,function(o,n){f.push(n.groups)});var i=[];var h=AJS.$.parseJSON(AJS.$.ajax({url:b+"/rest/dealertracks/servicedeskrest/1.0/ServiceDeskField/getServiceDeskMainFields.json",type:"GET",contentType:"application/json",async:false}).responseText);AJS.$.each(h,function(o,n){i.push(n.name)});AJS.$(this).parent().html('<td class="tdhout">	<span class="aui-restfultable-hovercell" data-field-name="icon"><input type="hidden" name="requestTypeIcon" id="requestTypeIcon" value="'+e[0]+'"><div aria-hidden="true" class="'+e[0]+'"></div></span>	</td><td class="tdhout"><input value="'+e[1]+'" class="text" /></td><td class="tdhout" id="editGroup'+e[5]+'"></td><td class="tdhout"><input value="'+e[3]+'" class="text" /></td><td class="tdhout" id="editServiceDesks'+e[5]+'"></td><td colspan="2"><input type="hidden" value="'+e[5]+'" /><input type="button" class="aui-button updateBtn" value="Update" style="margin-right:10px"/><a  href="javascript:void(0);" class="cancelBtn aui-button aui-button-link aui-restfultable-delete" original-title="">Cancel</a></td><td class="aui-restfultable-status"><span class="aui-restfultable-throbber"></span></td><td></td>');var m=[];var j=e[2];if(j.indexOf(",")>=0){m=j.split(",")}else{m.push(j)}getGroupDropDownList("editGroup","editGroup"+e[5],f,m);getServiceDeskDropDownList("editSerivedesk","editServiceDesks"+e[5],i,e[4]);AJS.$("select[id^='editGroup']").auiSelect2()});AJS.$(".newGroup").live("click",function(){});AJS.$("#request-types-table tbody tr td .updateBtn").live("click",function(){var f=AJS.$(this).closest("tr");var e=[];AJS.$(this).closest("tr").find("td").each(function(){var g="";AJS.$(this).find("select").each(function(){g=AJS.$(this).val()});if(g===""){AJS.$(this).find("input").each(function(){if(AJS.$(this).is(":text")){g=AJS.$(this).val()}if(AJS.$(this).is(":hidden")){g=AJS.$(this).val()}})}if(g===""){g=AJS.$(this).text()}e.push(g)});if(e[1]!==null){if(d(e[1])&&d(e[3])){if(e[2]===null){alert("Please select group")}else{if(e[4]==="None"){alert("Please select Service desk")}else{AJS.$.ajax({url:b+"/rest/dealertracks/servicedeskrest/1.0/ServiceDeskField/updateServiceDeskField.json?item="+e[1]+"&icon="+e[0]+"&groups="+e[2]+"&url="+e[3]+"&servicedesks="+e[4]+"&serviceID="+e[5],type:"PUT",contentType:"application/json",data:{},success:function(g){AJS.$("#request-types-table tbody tr").remove();AJS.$.each(g,function(j,h){AJS.$('<tr class="aui-restfultable-readonly aui-restfultable-row"></tr>').html('<td class="tdcls request-type-icon"> 	<span class="aui-restfultable-hovercell" data-field-name="icon"><input type="hidden" name="requestTypeIcon" id="requestTypeIcon" value="'+h.icon+'"><div aria-hidden="true" class="'+h.icon+'"></div></span>	</td><td class="tdcls"><div class="tdwrapcls" title="'+h.item+'">'+h.item+'</div></td><td class="tdcls"><div class="tdwrapcls" title="'+h.groups+'">'+h.groups+'</div></td><td class="tdcls"><div class="tdurlWrapcls"  title="'+h.url+'">'+h.url+'</div></td><td class="tdcls">'+h.servicedesks+'</td><td colspan="2"><input type="hidden" value="'+h.serviceID+'" /><a  href="javascript:void(0);" class="delBtn aui-button aui-button-link aui-restfultable-delete" original-title="">Delete</a></td>').appendTo("#request-types-table")})}})}}}}});AJS.$("#request-types-table tbody tr td .cancelBtn").live("click",function(){AJS.$.ajax({url:b+"/rest/dealertracks/servicedeskrest/1.0/ServiceDeskField/getServiceDeskFields.json",type:"GET",contentType:"application/json",data:{},success:function(e){AJS.$("#request-types-table tbody tr").remove();AJS.$.each(e,function(g,f){AJS.$('<tr id="'+f.serviceID+'" class="aui-restfultable-editrow aui-restfultable-row "></tr>').html('<td class="tdcls request-type-icon">	<span class="aui-restfultable-hovercell" data-field-name="icon"><input type="hidden" name="requestTypeIcon" id="requestTypeIcon" value="'+f.icon+'"><div aria-hidden="true" class="'+f.icon+'"></div></span>	</td><td class="tdcls"><div class="tdwrapcls" title="'+f.item+'">'+f.item+'</div><div class="icons"></div></td><td class="tdcls"><div class="tdwrapcls"  title="'+f.groups+'">'+f.groups+'</div></td><td class="tdcls"><div class="tdurlWrapcls" title="'+f.url+'">'+f.url+'</td><td class="tdcls">'+f.servicedesks+'</div></td><td colspan="2"><input type="hidden" value="'+f.serviceID+'"/><a  href="javascript:void(0);" class="delBtn aui-button aui-button-link aui-restfultable-delete" original-title="">Delete</a></td>').appendTo("#request-types-table")})}})});AJS.$("#request-types-table thead tr td .addBtn").live("click",function(){var g=AJS.$("#nameID").val();var i=AJS.$("#groups").val();if(i==="undefined"){i=""}var f=AJS.$("#urlID").val();var e=AJS.$("#serviceDesk").val();var h=AJS.$(".request-type-icon-add").find("input:hidden").val();if(h===""){h="trigger-icon-edit vp-rq-icon vp-rq-icon-32"}if(g!==null){if(d(g)&&d(f)){if(i===null){alert("Please select group")}else{if(e==="None"){alert("Please select Service desk")}else{AJS.$.ajax({url:b+"/rest/dealertracks/servicedeskrest/1.0/ServiceDeskField/addServiceDeskField.json?item="+g+"&icon="+h+"&groups="+i+"&url="+f+"&servicedesks="+e,type:"PUT",contentType:"application/json",data:{},success:function(j){AJS.$("#request-types-table tbody tr").remove();AJS.$.each(j,function(l,k){AJS.$('<tr class="aui-restfultable-readonly aui-restfultable-row"></tr>').html('<td class="tdcls request-type-icon">	<span class="aui-restfultable-hovercell" data-field-name="icon"><input type="hidden" name="requestTypeIcon" id="requestTypeIcon" value="'+k.icon+'"><div aria-hidden="true" class="'+k.icon+'"></div></span>	 </td><td ><div class="tdwrapcls"  title="'+k.item+'">'+k.item+'</div></td><td ><div class="tdwrapcls"   title="'+k.groups+'">'+k.groups+'</div></td><td ><div class="tdurlWrapcls"  title="'+k.url+'">'+k.url+"</div></td><td >"+k.servicedesks+'</td><td colspan="2"><input type="hidden" value="'+k.serviceID+'" /><a  href="javascript:void(0);" class="delBtn aui-button aui-button-link aui-restfultable-delete" original-title="">Delete</a></td>').appendTo("#request-types-table")})}})}}}}});AJS.$("#request-types-table tbody tr td .delBtn").live("click",function(){var f=AJS.$(this).closest("tr");var e=[];AJS.$(this).closest("tr").find("td").each(function(){var g="";AJS.$(this).find("select").each(function(){g=AJS.$(this).val()});if(g===""){AJS.$(this).find("input").each(function(){if(AJS.$(this).is(":text")){g=AJS.$(this).val()}if(AJS.$(this).is(":hidden")){g=AJS.$(this).val()}})}if(g===""){g=AJS.$(this).text()}e.push(g)});if(name!==null){AJS.$.ajax({url:b+"/rest/dealertracks/servicedeskrest/1.0/ServiceDeskField/deleteServiceDeskField.json?item="+e[1]+'&icon="" &groups='+e[2]+"&url="+e[3]+"&servicedesks="+e[4],type:"PUT",contentType:"application/json",data:{},success:function(g){AJS.$("#request-types-table tbody tr").remove();AJS.$.each(g,function(j,h){AJS.$('<tr class="aui-restfultable-readonly aui-restfultable-row"></tr>').html('<td class="tdcls request-type-icon"><span class="aui-restfultable-hovercell" data-field-name="icon"><input type="hidden" name="requestTypeIcon" id="requestTypeIcon" value="'+h.icon+'"><div aria-hidden="true" class="'+h.icon+'"></div></span></td><td class="tdcls"><div class="tdwrapcls" title="'+h.item+'">'+h.item+'</div></td><td class="tdcls"><div class="tdwrapcls" title="'+h.groups+'">'+h.groups+'</div></td><td class="tdcls"><div class="tdurlWrapcls" title="'+h.url+'">'+h.url+'</div></td><td class="tdcls">'+h.servicedesks+'</td><td colspan="2"><input type="hidden" value="'+h.serviceID+'" /><a  href="javascript:void(0);" class="delBtn aui-button aui-button-link aui-restfultable-delete" original-title="">Delete</a></td>').appendTo("#request-types-table")})}})}});function d(e){if(e===null){alert("Please enter required details");return false}if(e.match(/[`%&~,<>;'"\[\]\|{}()=_+]/)){alert("Special characters are not allowed");return false}else{return true}}function c(){AJS.$.ajax({url:b+"/rest/dealertracks/servicedeskrest/1.0/ServiceDeskMgmtResource/ldapServiceDesk",type:"GET",contentType:"application/json",success:function(e){AJS.$("#ldapinitctx").attr("value",e.ldapInitCtx);AJS.$("#ldapsrvrname").attr("value",e.ldapSrvrName);AJS.$("#ldapbasedn").attr("value",e.ldapBaseDn);AJS.$("#ldapuid").attr("value",e.ldapUid);AJS.$("#ldappwd").attr("value",e.ldapPwd);AJS.$("#dtincldappwd").attr("value",e.dtincLdapPwd)}})}function a(){AJS.$.ajax({url:b+"/rest/dealertracks/servicedeskrest/1.0/ServiceDeskMgmtResource/ldapsave",type:"PUT",contentType:"application/json",data:'{ "ldapInitCtx": "'+AJS.$("#ldapinitctx").attr("value")+'","ldapSrvrName": "'+AJS.$("#ldapsrvrname").attr("value")+'", "ldapBaseDn": "'+AJS.$("#ldapbasedn").attr("value")+'", "ldapUid": "'+AJS.$("#ldapuid").attr("value")+'", "ldapPwd": "'+AJS.$("#ldappwd").attr("value")+'", "dtincLdapPwd": "'+AJS.$("#dtincldappwd").attr("value")+'" }',processData:false,success:function(){JIRA.Messages.showSuccessMsg("ldap Plugin Configuration Saved Successfully!")},error:function(g,e,f){JIRA.Messages.showErrorMsg("LDAP Plugin Configuration could not be saved!<br><b>Server returned the following Error:</b><br> "+g.responseText)}})}c();AJS.$("#ldapSrvc").submit(function(f){a()})});function getServiceDeskDropDownList(a,f,e,c){var d=AJS.$("<select class='select'></select>").attr("id",a);d.append("<option value='None'>---select---</option>");if(e!==null){var b=[];AJS.$.each(e,function(g,h){if(AJS.$.inArray(h,b)===-1){b.push(h);if(c===h){d.append("<option value='"+h+"' title='"+h+"'  selected='selected'>"+h+"</option>")}else{d.append("<option value='"+h+"'  title='"+h+"'>"+h+"</option>")}}})}AJS.$("#"+f).append(d)}function getGroupDropDownList(a,f,e,c){var d=AJS.$("<select multiple='multiple' class='select'></select>").attr("id",a);if(e!==null){var b=[];AJS.$.each(e,function(g,h){if(AJS.$.inArray(h,b)===-1){if(h.indexOf(",")===-1){b.push(h);if(AJS.$.inArray(h,c)!==-1){d.append("<option value='"+h+"' title='"+h+"' selected='selected'>"+h+"</option>")}else{d.append("<option value='"+h+"'  title='"+h+"'>"+h+"</option>")}}else{var j=h.split(",");AJS.$.each(j,function(i,k){if(AJS.$.inArray(k,b)===-1){b.push(k);if(AJS.$.inArray(k,c)!==-1){d.append("<option value='"+k+"'  title='"+k+"'  selected='selected'>"+k+"</option>")}else{d.append("<option value='"+k+"' title='"+k+"'>"+k+"</option>")}}})}}})}AJS.$("#"+f).append(d)}function getDropDownList(a,e,d,b){var c=AJS.$("<select style='height:80px' class='select'></select>").attr("id",a);c.append("<option value='None'>---select---</option>");if(d!==null){AJS.$.each(d,function(f,g){if(b===g.Name){c.append("<option value='"+g.Name+"' title='"+g.Name+"'  selected='selected'>"+g.Name+"</option>")}else{c.append("<option  value='"+g.Name+"'  title='"+g.Name+"'>"+g.Name+"</option>")}})}AJS.$("#"+e).append(c)}AJS.$(function(){AJS.$("#serviceDesk").auiSelect2();AJS.$("#groups").auiSelect2();AJS.$("select[id^='editGroup']").auiSelect2();AJS.$(".cv-breadcrumb-item-link").add});