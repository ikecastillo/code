(function(f){var a=new Array();var c=new Array();var b=new Array();var h;function i(){var l=f.ajax({key:"cisubtask",url:AJS.params.baseURL+"/rest/createci/1.0/subtask",type:"PUT",contentType:"application/json",processData:false,data:e(),success:function(m){var n=f("#view-subtasks").css("visibility");if(f.trim(n)==""&&a.length>0){JIRA.Messages.showSuccessMsg("Sub-tasks created successfully for the selected CI's. Please refresh the page once.");a=new Array();c=new Array();b=new Array()}}})}function d(){var l=f.ajax({key:"cisubtask",url:AJS.params.baseURL+"/rest/createci/1.0/subtask",type:"PUT",contentType:"application/json",processData:false,data:e(),success:function(m){var n=f("#view-subtasks").css("visibility");if(f.trim(n)==""){JIRA.Messages.showSuccessMsg("Sub-tasks created successfully for the selected CI's. Please refresh the page once.")}else{JIRA.Messages.showSuccessMsg("Sub-tasks created successfully for the selected CI's.");f("#subtasks-show-all").click();a=new Array();c=new Array();b=new Array()}}})}function j(l){console.log(" createCISubtask");var m=f(".rlabs-customfield .rlabs-customfield-openicon").find("span").attr("data-fieldname-key");console.log("customfield "+m);f("#"+m+" option:selected",l).each(function(){var q=f(this).attr("value");q=AJS.$.trim(q);console.log("newdata "+q);if(q!==""){a.push(q);console.log("newdata "+q);var o;var n;var p=f.ajax({key:"dtschema",url:AJS.params.baseURL+"/rest/insight/1.0/object/"+q,contentType:"application/json",success:function(r){console.log("response "+JSON.stringify(r));f.each(r.attributes,function(){if(this.objectTypeAttribute){console.log("name "+this.objectTypeAttribute.name);if(this.objectTypeAttribute.name=="Name"){attribValues=this.objectAttributeValues;if(attribValues&&attribValues.length>0){o=attribValues[0].value}}if(this.objectTypeAttribute.name=="Owner"){attribValues=this.objectAttributeValues;if(attribValues&&attribValues.length>0){if(attribValues[0].user){n=attribValues[0].user.name}}}}});c.push(o);b.push(n)},async:false})}});d()}function e(){var l=new Array();f.each(a,function(m,n){var o={insightObj:a[m],subject:c[m],owner:b[m],issueKey:f("#key-val").text()};l.push(o)});console.log("getData "+JSON.stringify(l));return JSON.stringify(l)}function k(l){f(".rlabs-customfield-viewdialog-object",l).each(function(){var m=f(this).attr("data-key");console.log("new data updated"+m)});f(".rlabs-customfield-viewdialog-object",l).each(function(){var p=f(this).attr("data-key");p=AJS.$.trim(p);if(p!==""){a.push(p);var n;var m;var o=f.ajax({key:"dtschema",url:AJS.params.baseURL+"/rest/insight/1.0/object/"+p,contentType:"application/json",success:function(q){f.each(q.attributes,function(){if(this.objectTypeAttribute){console.log("name "+this.objectTypeAttribute.name);if(this.objectTypeAttribute.name=="Name"){attribValues=this.objectAttributeValues;if(attribValues&&attribValues.length>0){n=attribValues[0].value}}if(this.objectTypeAttribute.name=="Owner"){attribValues=this.objectAttributeValues;if(attribValues&&attribValues.length>0){if(attribValues[0].user){m=attribValues[0].user.name}}}}});c.push(n);b.push(m)},async:false})}});i()}function g(m,p){console.log("issue sub task created on page load: ");var l=0;p.sort();var o=new Array();var n=f(".rlabs-customfield .rlabs-customfield-openicon").find("span").attr("data-fieldname-key");f("#"+n+" option:selected",m).each(function(){var q=f(this).attr("value");q=AJS.$.trim(q);o.push(q)});if(o.length==0){return 1}o.sort();console.log("datakeyArr "+p);console.log("newdataArr "+o);if(o.length>p.length){return l}else{f.each(o,function(q,r){if(o[q]===p[q]){l=1}})}return l}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(q,l,p){var v=AJS.$("#create-issue-submit").val();var r=AJS.$("#issue-create-submit").val();var t=AJS.$("#edit-issue-submit").val();var u=AJS.$(l).text();console.log("selectCi: "+u);console.log("context: "+l);console.log("edit value: "+t);console.log("createAdmin value: "+r);console.log("createUser value: "+v);f("#stqc_show").css("visibility","hidden");var o=AJS.$("#type-val").text();o=AJS.$.trim(o);var s=new Array();if(o=="Change"){var m=f("#key-val").text();var n=f("#issuedetails").find("#status-val span").text();console.log("issuekey: "+m);console.log("statusval: "+n);if(p==JIRA.CONTENT_ADDED_REASON.pageLoad){if(m!==""&&n!==""){if(n=="Initiated"){f("#customfield-panel-3 .rlabs-customfield-viewdialog-object").each(function(){console.log(f(this).attr("data-key"));s.push(f(this).attr("data-key"))});a=new Array();c=new Array();b=new Array();h=true;k(l)}}}if(t=="Update"||u.contains("Select CI")){f(l).find("form").submit(function(x){var w=g(l,s);if(parseInt(w)==0){console.log("issue sub task created on page load: "+w);h=false;j(l)}})}}})})(AJS.$);