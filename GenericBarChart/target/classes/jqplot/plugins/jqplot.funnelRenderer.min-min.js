(function(t){t.jqplot.FunnelRenderer=function(){t.jqplot.LineRenderer.call(this)};t.jqplot.FunnelRenderer.prototype=new t.jqplot.LineRenderer();t.jqplot.FunnelRenderer.prototype.constructor=t.jqplot.FunnelRenderer;t.jqplot.FunnelRenderer.prototype.init=function(f,b){this.padding={top:20,right:20,bottom:20,left:20};this.sectionMargin=6;this.fill=true;this.shadowOffset=2;this.shadowAlpha=0.07;this.shadowDepth=5;this.highlightMouseOver=true;this.highlightMouseDown=false;this.highlightColors=[];this.widthRatio=0.2;this.lineWidth=2;this.dataLabels="percent";this.showDataLabels=false;this.dataLabelFormatString=null;this.dataLabelThreshold=3;this._type="funnel";this.tickRenderer=t.jqplot.FunnelTickRenderer;if(f.highlightMouseDown&&f.highlightMouseOver==null){f.highlightMouseOver=false}t.extend(true,this,f);this._highlightedPoint=null;this._bases=[];this._atot;this._areas=[];this._lengths=[];this._angle;this._dataIndices=[];this._unorderedData=t.extend(true,[],this.data);var g=t.extend(true,[],this.data);for(var d=0;d<g.length;d++){g[d].push(d)}this.data.sort(function(i,j){return j[1]-i[1]});g.sort(function(i,j){return j[1]-i[1]});for(var d=0;d<g.length;d++){this._dataIndices.push(g[d][2])}if(this.highlightColors.length==0){for(var d=0;d<this.seriesColors.length;d++){var e=t.jqplot.getColorComponents(this.seriesColors[d]);var a=[e[0],e[1],e[2]];var c=a[0]+a[1]+a[2];for(var h=0;h<3;h++){a[h]=(c>570)?a[h]*0.8:a[h]+0.4*(255-a[h]);a[h]=parseInt(a[h],10)}this.highlightColors.push("rgb("+a[0]+","+a[1]+","+a[2]+")")}}b.postParseOptionsHooks.addOnce(n);b.postInitHooks.addOnce(r);b.eventListenerHooks.addOnce("jqplotMouseMove",x);b.eventListenerHooks.addOnce("jqplotMouseDown",w);b.eventListenerHooks.addOnce("jqplotMouseUp",o);b.eventListenerHooks.addOnce("jqplotClick",s);b.eventListenerHooks.addOnce("jqplotRightClick",m);b.postDrawHooks.addOnce(q)};t.jqplot.FunnelRenderer.prototype.setGridData=function(c){var d=0;var b=[];for(var a=0;a<this.data.length;a++){d+=this.data[a][1];b.push([this.data[a][0],this.data[a][1]])}for(var a=0;a<b.length;a++){b[a][1]=b[a][1]/d}this._bases=new Array(b.length+1);this._lengths=new Array(b.length);this.gridData=b};t.jqplot.FunnelRenderer.prototype.makeGridData=function(d,c){var e=0;var b=[];for(var a=0;a<this.data.length;a++){e+=this.data[a][1];b.push([this.data[a][0],this.data[a][1]])}for(var a=0;a<b.length;a++){b[a][1]=b[a][1]/e}this._bases=new Array(b.length+1);this._lengths=new Array(b.length);return b};t.jqplot.FunnelRenderer.prototype.drawSection=function(h,f,g,c){var b=this.fill;var a=this.lineWidth;h.save();if(c){for(var d=0;d<this.shadowDepth;d++){h.save();h.translate(this.shadowOffset*Math.cos(this.shadowAngle/180*Math.PI),this.shadowOffset*Math.sin(this.shadowAngle/180*Math.PI));e()}}else{e()}function e(){h.beginPath();h.fillStyle=g;h.strokeStyle=g;h.lineWidth=a;h.moveTo(f[0][0],f[0][1]);for(var i=1;i<4;i++){h.lineTo(f[i][0],f[i][1])}h.closePath();if(b){h.fill()}else{h.stroke()}}if(c){for(var d=0;d<this.shadowDepth;d++){h.restore()}}h.restore()};t.jqplot.FunnelRenderer.prototype.draw=function(am,aw,aj,aH){var b;var ah=(aj!=undefined)?aj:{};var aB=0;var aC=0;var i=1;this._areas=[];if(aj.legendInfo&&aj.legendInfo.placement=="insideGrid"){var l=aj.legendInfo;switch(l.location){case"nw":aB=l.width+l.xoffset;break;case"w":aB=l.width+l.xoffset;break;case"sw":aB=l.width+l.xoffset;break;case"ne":aB=l.width+l.xoffset;i=-1;break;case"e":aB=l.width+l.xoffset;i=-1;break;case"se":aB=l.width+l.xoffset;i=-1;break;case"n":aC=l.height+l.yoffset;break;case"s":aC=l.height+l.yoffset;i=-1;break;default:break}}var aD=(i==1)?this.padding.left+aB:this.padding.left;var an=(i==1)?this.padding.top+aC:this.padding.top;var ag=(i==-1)?this.padding.right+aB:this.padding.right;var aI=(i==-1)?this.padding.bottom+aC:this.padding.bottom;var k=(ah.shadow!=undefined)?ah.shadow:this.shadow;var aG=(ah.showLine!=undefined)?ah.showLine:this.showLine;var au=(ah.fill!=undefined)?ah.fill:this.fill;var al=am.canvas.width;var y=am.canvas.height;this._bases[0]=al-aD-ag;var ak=this._length=y-an-aI;var aF=this._bases[0]*this.widthRatio;this._atot=ak/2*(this._bases[0]+this._bases[0]*this.widthRatio);this._angle=Math.atan((this._bases[0]-aF)/2/ak);for(b=0;b<aw.length;b++){this._areas.push(aw[b][1]*this._atot)}var ap,az,d,j=0;var aJ=0.0001;for(b=0;b<this._areas.length;b++){ap=this._areas[b]/this._bases[b];az=999999;this._lengths[b]=ap;d=0;while(az>this._lengths[b]*aJ&&d<100){this._lengths[b]=this._areas[b]/(this._bases[b]-this._lengths[b]*Math.tan(this._angle));az=Math.abs(this._lengths[b]-ap);this._bases[b+1]=this._bases[b]-(2*this._lengths[b]*Math.tan(this._angle));ap=this._lengths[b];d++}j+=this._lengths[b]}this._vertices=new Array(aw.length);var aq=[aD,an],at=[aD+this._bases[0],an],av=[aD+(this._bases[0]-this._bases[this._bases.length-1])/2,an+this._length],ay=[av[0]+this._bases[this._bases.length-1],av[1]];function e(C){var z=(aq[1]-av[1])/(aq[0]-av[0]);var B=aq[1]-z*aq[0];var A=C+aq[1];return[(A-B)/z,A]}function ar(C){var z=(at[1]-ay[1])/(at[0]-ay[0]);var B=at[1]-z*at[0];var A=C+at[1];return[(A-B)/z,A]}var g=aB,h=aC;var a=0,aK=0;for(b=0;b<aw.length;b++){this._vertices[b]=new Array();var f=this._vertices[b];var ax=this.sectionMargin;if(b==0){aK=0}if(b==1){aK=ax/3}else{if(b>0&&b<aw.length-1){aK=ax/2}else{if(b==aw.length-1){aK=2*ax/3}}}f.push(e(a+aK));f.push(ar(a+aK));a+=this._lengths[b];if(b==0){aK=-2*ax/3}else{if(b>0&&b<aw.length-1){aK=-ax/2}else{if(b==aw.length-1){aK=0}}}f.push(ar(a+aK));f.push(e(a+aK))}if(this.shadow){var ao="rgba(0,0,0,"+this.shadowAlpha+")";for(var b=0;b<aw.length;b++){this.renderer.drawSection.call(this,am,this._vertices[b],ao,true)}}for(var b=0;b<aw.length;b++){var f=this._vertices[b];this.renderer.drawSection.call(this,am,f,this.seriesColors[b]);if(this.showDataLabels&&aw[b][1]*100>=this.dataLabelThreshold){var ai,c;if(this.dataLabels=="label"){ai=this.dataLabelFormatString||"%s";c=t.jqplot.sprintf(ai,aw[b][0])}else{if(this.dataLabels=="value"){ai=this.dataLabelFormatString||"%d";c=t.jqplot.sprintf(ai,this.data[b][1])}else{if(this.dataLabels=="percent"){ai=this.dataLabelFormatString||"%d%%";c=t.jqplot.sprintf(ai,aw[b][1]*100)}else{if(this.dataLabels.constructor==Array){ai=this.dataLabelFormatString||"%s";c=t.jqplot.sprintf(ai,this.dataLabels[this._dataIndices[b]])}}}}var aE=(this._radius)*this.dataLabelPositionFactor+this.sliceMargin+this.dataLabelNudge;var g=(f[0][0]+f[1][0])/2+this.canvas._offsets.left;var h=(f[1][1]+f[2][1])/2+this.canvas._offsets.top;var aA=t('<span class="jqplot-funnel-series jqplot-data-label" style="position:absolute;">'+c+"</span>").insertBefore(aH.eventCanvas._elem);g-=aA.width()/2;h-=aA.height()/2;g=Math.round(g);h=Math.round(h);aA.css({left:g,top:h})}}};t.jqplot.FunnelAxisRenderer=function(){t.jqplot.LinearAxisRenderer.call(this)};t.jqplot.FunnelAxisRenderer.prototype=new t.jqplot.LinearAxisRenderer();t.jqplot.FunnelAxisRenderer.prototype.constructor=t.jqplot.FunnelAxisRenderer;t.jqplot.FunnelAxisRenderer.prototype.init=function(a){this.tickRenderer=t.jqplot.FunnelTickRenderer;t.extend(true,this,a);this._dataBounds={min:0,max:100};this.min=0;this.max=100;this.showTicks=false;this.ticks=[];this.showMark=false;this.show=false};t.jqplot.FunnelLegendRenderer=function(){t.jqplot.TableLegendRenderer.call(this)};t.jqplot.FunnelLegendRenderer.prototype=new t.jqplot.TableLegendRenderer();t.jqplot.FunnelLegendRenderer.prototype.constructor=t.jqplot.FunnelLegendRenderer;t.jqplot.FunnelLegendRenderer.prototype.init=function(a){this.numberRows=null;this.numberColumns=null;t.extend(true,this,a)};t.jqplot.FunnelLegendRenderer.prototype.draw=function(){var J=this;if(this.show){var c=this._series;var I="position:absolute;";I+=(this.background)?"background:"+this.background+";":"";I+=(this.border)?"border:"+this.border+";":"";I+=(this.fontSize)?"font-size:"+this.fontSize+";":"";I+=(this.fontFamily)?"font-family:"+this.fontFamily+";":"";I+=(this.textColor)?"color:"+this.textColor+";":"";I+=(this.marginTop!=null)?"margin-top:"+this.marginTop+";":"";I+=(this.marginBottom!=null)?"margin-bottom:"+this.marginBottom+";":"";I+=(this.marginLeft!=null)?"margin-left:"+this.marginLeft+";":"";I+=(this.marginRight!=null)?"margin-right:"+this.marginRight+";":"";this._elem=t('<table class="jqplot-table-legend" style="'+I+'"></table>');var h=false,d=false,M,g;var b=c[0];var L=new t.jqplot.ColorGenerator(b.seriesColors);if(b.show){var f=b.data;if(this.numberRows){M=this.numberRows;if(!this.numberColumns){g=Math.ceil(f.length/M)}else{g=this.numberColumns}}else{if(this.numberColumns){g=this.numberColumns;M=Math.ceil(f.length/this.numberColumns)}else{M=f.length;g=1}}var j,k,K,l,H,i,e,G;var a=0;for(j=0;j<M;j++){if(d){K=t('<tr class="jqplot-table-legend"></tr>').prependTo(this._elem)}else{K=t('<tr class="jqplot-table-legend"></tr>').appendTo(this._elem)}for(k=0;k<g;k++){if(a<f.length){i=this.labels[a]||f[a][0].toString();G=L.next();if(!d){if(j>0){h=true}else{h=false}}else{if(j==M-1){h=false}else{h=true}}e=(h)?this.rowSpacing:"0";l=t('<td class="jqplot-table-legend" style="text-align:center;padding-top:'+e+';"><div><div class="jqplot-table-legend-swatch" style="border-color:'+G+';"></div></div></td>');H=t('<td class="jqplot-table-legend" style="padding-top:'+e+';"></td>');if(this.escapeHtml){H.text(i)}else{H.html(i)}if(d){H.prependTo(K);l.prependTo(K)}else{l.appendTo(K);H.appendTo(K)}h=true}a++}}}}return this._elem};function v(b,c,e){e=e||{};e.axesDefaults=e.axesDefaults||{};e.legend=e.legend||{};e.seriesDefaults=e.seriesDefaults||{};var a=false;if(e.seriesDefaults.renderer==t.jqplot.FunnelRenderer){a=true}else{if(e.series){for(var d=0;d<e.series.length;d++){if(e.series[d].renderer==t.jqplot.FunnelRenderer){a=true}}}}if(a){e.axesDefaults.renderer=t.jqplot.FunnelAxisRenderer;e.legend.renderer=t.jqplot.FunnelLegendRenderer;e.legend.preDraw=true;e.sortData=false;e.seriesDefaults.pointLabels={show:false}}}function r(b,c,a){for(var d=0;d<this.series.length;d++){if(this.series[d].renderer.constructor==t.jqplot.FunnelRenderer){if(this.series[d].highlightMouseOver){this.series[d].highlightMouseDown=false}}}}function n(a){for(var b=0;b<this.series.length;b++){this.series[b].seriesColors=this.seriesColors;this.series[b].colorGenerator=t.jqplot.colorGenerator}}function u(b,c,d){var e=b.series[c];var a=b.plugins.funnelRenderer.highlightCanvas;a._ctx.clearRect(0,0,a._ctx.canvas.width,a._ctx.canvas.height);e._highlightedPoint=d;b.plugins.funnelRenderer.highlightedSeriesIndex=c;e.renderer.drawSection.call(e,a._ctx,e._vertices[d],e.highlightColors[d],false)}function p(b){var a=b.plugins.funnelRenderer.highlightCanvas;a._ctx.clearRect(0,0,a._ctx.canvas.width,a._ctx.canvas.height);for(var c=0;c<b.series.length;c++){b.series[c]._highlightedPoint=null}b.plugins.funnelRenderer.highlightedSeriesIndex=null;b.target.trigger("jqplotDataUnhighlight")}function x(e,f,b,c,d){if(c){var g=[c.seriesIndex,c.pointIndex,c.data];var h=jQuery.Event("jqplotDataMouseOver");h.pageX=e.pageX;h.pageY=e.pageY;d.target.trigger(h,g);if(d.series[g[0]].highlightMouseOver&&!(g[0]==d.plugins.funnelRenderer.highlightedSeriesIndex&&g[1]==d.series[g[0]]._highlightedPoint)){var a=jQuery.Event("jqplotDataHighlight");a.which=e.which;a.pageX=e.pageX;a.pageY=e.pageY;d.target.trigger(a,g);u(d,g[0],g[1])}}else{if(c==null){p(d)}}}function w(e,f,b,c,d){if(c){var g=[c.seriesIndex,c.pointIndex,c.data];if(d.series[g[0]].highlightMouseDown&&!(g[0]==d.plugins.funnelRenderer.highlightedSeriesIndex&&g[1]==d.series[g[0]]._highlightedPoint)){var a=jQuery.Event("jqplotDataHighlight");a.which=e.which;a.pageX=e.pageX;a.pageY=e.pageY;d.target.trigger(a,g);u(d,g[0],g[1])}}else{if(c==null){p(d)}}}function o(e,f,b,c,d){var a=d.plugins.funnelRenderer.highlightedSeriesIndex;if(a!=null&&d.series[a].highlightMouseDown){p(d)}}function s(e,f,b,c,d){if(c){var g=[c.seriesIndex,c.pointIndex,c.data];var a=jQuery.Event("jqplotDataClick");a.which=e.which;a.pageX=e.pageX;a.pageY=e.pageY;d.target.trigger(a,g)}}function m(e,f,b,c,d){if(c){var g=[c.seriesIndex,c.pointIndex,c.data];var a=d.plugins.funnelRenderer.highlightedSeriesIndex;if(a!=null&&d.series[a].highlightMouseDown){p(d)}var h=jQuery.Event("jqplotDataRightClick");h.which=e.which;h.pageX=e.pageX;h.pageY=e.pageY;d.target.trigger(h,g)}}function q(){if(this.plugins.funnelRenderer&&this.plugins.funnelRenderer.highlightCanvas){this.plugins.funnelRenderer.highlightCanvas.resetCanvas();this.plugins.funnelRenderer.highlightCanvas=null}this.plugins.funnelRenderer={};this.plugins.funnelRenderer.highlightCanvas=new t.jqplot.GenericCanvas();var b=t(this.targetId+" .jqplot-data-label");if(b.length){t(b[0]).before(this.plugins.funnelRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-funnelRenderer-highlight-canvas",this._plotDimensions,this))}else{this.eventCanvas._elem.before(this.plugins.funnelRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-funnelRenderer-highlight-canvas",this._plotDimensions,this))}var a=this.plugins.funnelRenderer.highlightCanvas.setContext();this.eventCanvas._elem.bind("mouseleave",{plot:this},function(c){p(c.data.plot)})}t.jqplot.preInitHooks.push(v);t.jqplot.FunnelTickRenderer=function(){t.jqplot.AxisTickRenderer.call(this)};t.jqplot.FunnelTickRenderer.prototype=new t.jqplot.AxisTickRenderer();t.jqplot.FunnelTickRenderer.prototype.constructor=t.jqplot.FunnelTickRenderer})(jQuery);