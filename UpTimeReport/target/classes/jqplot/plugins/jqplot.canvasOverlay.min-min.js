(function(w){var u=0;w.jqplot.CanvasOverlay=function(d){var f=d||{};this.options={show:w.jqplot.config.enablePlugins,deferDraw:false};this.objects=[];this.objectNames=[];this.canvas=null;this.markerRenderer=new w.jqplot.MarkerRenderer({style:"line"});this.markerRenderer.init();this.highlightObjectIndex=null;if(f.objects){var b=f.objects,c;for(var e=0;e<b.length;e++){c=b[e];for(var a in c){switch(a){case"line":this.addLine(c[a]);break;case"horizontalLine":this.addHorizontalLine(c[a]);break;case"dashedHorizontalLine":this.addDashedHorizontalLine(c[a]);break;case"verticalLine":this.addVerticalLine(c[a]);break;case"dashedVerticalLine":this.addDashedVerticalLine(c[a]);break;case"rectangle":this.addRectangle(c[a]);break;default:break}}}}w.extend(true,this.options,f)};w.jqplot.CanvasOverlay.postPlotInit=function(a,b,c){var d=c||{};this.plugins.canvasOverlay=new w.jqplot.CanvasOverlay(d.canvasOverlay)};function r(){this.uid=null;this.type=null;this.gridStart=null;this.gridStop=null;this.tooltipWidthFactor=0;this.options={name:null,show:true,lineWidth:2,lineCap:"round",color:"#666666",shadow:true,shadowAngle:45,shadowOffset:1,shadowDepth:3,shadowAlpha:"0.07",xaxis:"xaxis",yaxis:"yaxis",showTooltip:false,showTooltipPrecision:0.6,tooltipLocation:"nw",fadeTooltip:true,tooltipFadeSpeed:"fast",tooltipOffset:4,tooltipFormatString:"%d, %d"}}function n(b){r.call(this);this.type="rectangle";var a={xmin:null,xmax:null,xOffset:"6px",xminOffset:null,xmaxOffset:null,ymin:null,ymax:null,yOffset:"6px",yminOffset:null,ymaxOffset:null};w.extend(true,this.options,a,b);if(this.options.showTooltipPrecision<0.01){this.options.showTooltipPrecision=0.01}}n.prototype=new r();n.prototype.constructor=n;function y(b){r.call(this);this.type="line";var a={start:[],stop:[]};w.extend(true,this.options,a,b);if(this.options.showTooltipPrecision<0.01){this.options.showTooltipPrecision=0.01}}y.prototype=new r();y.prototype.constructor=y;function v(b){r.call(this);this.type="horizontalLine";var a={y:null,xmin:null,xmax:null,xOffset:"6px",xminOffset:null,xmaxOffset:null};w.extend(true,this.options,a,b);if(this.options.showTooltipPrecision<0.01){this.options.showTooltipPrecision=0.01}}v.prototype=new r();v.prototype.constructor=v;function q(b){r.call(this);this.type="dashedHorizontalLine";var a={y:null,xmin:null,xmax:null,xOffset:"6px",xminOffset:null,xmaxOffset:null,dashPattern:[8,8]};w.extend(true,this.options,a,b);if(this.options.showTooltipPrecision<0.01){this.options.showTooltipPrecision=0.01}}q.prototype=new r();q.prototype.constructor=q;function x(b){r.call(this);this.type="verticalLine";var a={x:null,ymin:null,ymax:null,yOffset:"6px",yminOffset:null,ymaxOffset:null};w.extend(true,this.options,a,b);if(this.options.showTooltipPrecision<0.01){this.options.showTooltipPrecision=0.01}}x.prototype=new r();x.prototype.constructor=x;function o(b){r.call(this);this.type="dashedVerticalLine";this.start=null;this.stop=null;var a={x:null,ymin:null,ymax:null,yOffset:"6px",yminOffset:null,ymaxOffset:null,dashPattern:[8,8]};w.extend(true,this.options,a,b);if(this.options.showTooltipPrecision<0.01){this.options.showTooltipPrecision=0.01}}o.prototype=new r();o.prototype.constructor=o;w.jqplot.CanvasOverlay.prototype.addLine=function(a){var b=new y(a);b.uid=u++;this.objects.push(b);this.objectNames.push(b.options.name)};w.jqplot.CanvasOverlay.prototype.addHorizontalLine=function(a){var b=new v(a);b.uid=u++;this.objects.push(b);this.objectNames.push(b.options.name)};w.jqplot.CanvasOverlay.prototype.addDashedHorizontalLine=function(a){var b=new q(a);b.uid=u++;this.objects.push(b);this.objectNames.push(b.options.name)};w.jqplot.CanvasOverlay.prototype.addVerticalLine=function(a){var b=new x(a);b.uid=u++;this.objects.push(b);this.objectNames.push(b.options.name)};w.jqplot.CanvasOverlay.prototype.addDashedVerticalLine=function(a){var b=new o(a);b.uid=u++;this.objects.push(b);this.objectNames.push(b.options.name)};w.jqplot.CanvasOverlay.prototype.addRectangle=function(a){var b=new n(a);b.uid=u++;this.objects.push(b);this.objectNames.push(b.options.name)};w.jqplot.CanvasOverlay.prototype.removeObject=function(b){if(w.type(b)=="number"){this.objects.splice(b,1);this.objectNames.splice(b,1)}else{var a=w.inArray(b,this.objectNames);if(a!=-1){this.objects.splice(a,1);this.objectNames.splice(a,1)}}};w.jqplot.CanvasOverlay.prototype.getObject=function(b){if(w.type(b)=="number"){return this.objects[b]}else{var a=w.inArray(b,this.objectNames);if(a!=-1){return this.objects[a]}}};w.jqplot.CanvasOverlay.prototype.get=w.jqplot.CanvasOverlay.prototype.getObject;w.jqplot.CanvasOverlay.prototype.clear=function(a){this.canvas._ctx.clearRect(0,0,this.canvas.getWidth(),this.canvas.getHeight())};w.jqplot.CanvasOverlay.prototype.draw=function(j){var ag,V=this.objects,X=this.markerRenderer,ab,U;if(this.options.show){this.canvas._ctx.clearRect(0,0,this.canvas.getWidth(),this.canvas.getHeight());for(var m=0;m<V.length;m++){ag=V[m];var af=w.extend(true,{},ag.options);if(ag.options.show){X.shadow=ag.options.shadow;ag.tooltipWidthFactor=ag.options.lineWidth/ag.options.showTooltipPrecision;switch(ag.type){case"line":X.style="line";af.closePath=false;ab=[j.axes[ag.options.xaxis].series_u2p(ag.options.start[0]),j.axes[ag.options.yaxis].series_u2p(ag.options.start[1])];U=[j.axes[ag.options.xaxis].series_u2p(ag.options.stop[0]),j.axes[ag.options.yaxis].series_u2p(ag.options.stop[1])];ag.gridStart=ab;ag.gridStop=U;X.draw(ab,U,this.canvas._ctx,af);break;case"horizontalLine":if(ag.options.y!=null){X.style="line";af.closePath=false;var ah=j.axes[ag.options.xaxis],a,h,T=j.axes[ag.options.yaxis].series_u2p(ag.options.y),l=ag.options.xminOffset||ag.options.xOffset,Z=ag.options.xmaxOffset||ag.options.xOffset;if(ag.options.xmin!=null){a=ah.series_u2p(ag.options.xmin)}else{if(l!=null){if(w.type(l)=="number"){a=ah.series_u2p(ah.min+l)}else{if(w.type(l)=="string"){a=ah.series_u2p(ah.min)+parseFloat(l)}}}}if(ag.options.xmax!=null){h=ah.series_u2p(ag.options.xmax)}else{if(Z!=null){if(w.type(Z)=="number"){h=ah.series_u2p(ah.max-Z)}else{if(w.type(Z)=="string"){h=ah.series_u2p(ah.max)-parseFloat(Z)}}}}if(h!=null&&a!=null){ag.gridStart=[a,T];ag.gridStop=[h,T];X.draw([a,T],[h,T],this.canvas._ctx,af)}}break;case"dashedHorizontalLine":var ai=ag.options.dashPattern;var Y=0;for(var g=0;g<ai.length;g++){Y+=ai[g]}if(ag.options.y!=null){X.style="line";af.closePath=false;var ah=j.axes[ag.options.xaxis],a,h,T=j.axes[ag.options.yaxis].series_u2p(ag.options.y),l=ag.options.xminOffset||ag.options.xOffset,Z=ag.options.xmaxOffset||ag.options.xOffset;if(ag.options.xmin!=null){a=ah.series_u2p(ag.options.xmin)}else{if(l!=null){if(w.type(l)=="number"){a=ah.series_u2p(ah.min+l)}else{if(w.type(l)=="string"){a=ah.series_u2p(ah.min)+parseFloat(l)}}}}if(ag.options.xmax!=null){h=ah.series_u2p(ag.options.xmax)}else{if(Z!=null){if(w.type(Z)=="number"){h=ah.series_u2p(ah.max-Z)}else{if(w.type(Z)=="string"){h=ah.series_u2p(ah.max)-parseFloat(Z)}}}}if(h!=null&&a!=null){ag.gridStart=[a,T];ag.gridStop=[h,T];var ad=Math.ceil((h-a)/Y);var c=a,e;for(var g=0;g<ad;g++){for(var k=0;k<ai.length;k+=2){e=c+ai[k];X.draw([c,T],[e,T],this.canvas._ctx,af);c+=ai[k];if(k<ai.length-1){c+=ai[k+1]}}}}}break;case"verticalLine":if(ag.options.x!=null){X.style="line";af.closePath=false;var f=j.axes[ag.options.yaxis],aj,W,i=j.axes[ag.options.xaxis].series_u2p(ag.options.x),aa=ag.options.yminOffset||ag.options.yOffset,ae=ag.options.ymaxOffset||ag.options.yOffset;if(ag.options.ymin!=null){aj=f.series_u2p(ag.options.ymin)}else{if(aa!=null){if(w.type(aa)=="number"){aj=f.series_u2p(f.min-aa)}else{if(w.type(aa)=="string"){aj=f.series_u2p(f.min)-parseFloat(aa)}}}}if(ag.options.ymax!=null){W=f.series_u2p(ag.options.ymax)}else{if(ae!=null){if(w.type(ae)=="number"){W=f.series_u2p(f.max+ae)}else{if(w.type(ae)=="string"){W=f.series_u2p(f.max)+parseFloat(ae)}}}}if(W!=null&&aj!=null){ag.gridStart=[i,aj];ag.gridStop=[i,W];X.draw([i,aj],[i,W],this.canvas._ctx,af)}}break;case"dashedVerticalLine":var ai=ag.options.dashPattern;var Y=0;for(var g=0;g<ai.length;g++){Y+=ai[g]}if(ag.options.x!=null){X.style="line";af.closePath=false;var f=j.axes[ag.options.yaxis],aj,W,i=j.axes[ag.options.xaxis].series_u2p(ag.options.x),aa=ag.options.yminOffset||ag.options.yOffset,ae=ag.options.ymaxOffset||ag.options.yOffset;if(ag.options.ymin!=null){aj=f.series_u2p(ag.options.ymin)}else{if(aa!=null){if(w.type(aa)=="number"){aj=f.series_u2p(f.min-aa)}else{if(w.type(aa)=="string"){aj=f.series_u2p(f.min)-parseFloat(aa)}}}}if(ag.options.ymax!=null){W=f.series_u2p(ag.options.ymax)}else{if(ae!=null){if(w.type(ae)=="number"){W=f.series_u2p(f.max+ae)}else{if(w.type(ae)=="string"){W=f.series_u2p(f.max)+parseFloat(ae)}}}}if(W!=null&&aj!=null){ag.gridStart=[i,aj];ag.gridStop=[i,W];var ad=Math.ceil((aj-W)/Y);var ac=((ad*Y)-(aj-W))/2;var c=aj,e,d,b;for(var g=0;g<ad;g++){for(var k=0;k<ai.length;k+=2){e=c-ai[k];if(e<W){e=W}if(c<W){c=W}X.draw([i,c],[i,e],this.canvas._ctx,af);c-=ai[k];if(k<ai.length-1){c-=ai[k+1]}}}}}break;case"rectangle":X.style="line";af.closePath=true;var ah=j.axes[ag.options.xaxis],a,h,T=j.axes[ag.options.yaxis].series_u2p(ag.options.y),l=ag.options.xminOffset||ag.options.xOffset,Z=ag.options.xmaxOffset||ag.options.xOffset;if(ag.options.xmin!=null){a=ah.series_u2p(ag.options.xmin)}else{if(l!=null){if(w.type(l)=="number"){a=ah.series_u2p(ah.min+l)}else{if(w.type(l)=="string"){a=ah.series_u2p(ah.min)+parseFloat(l)}}}}if(ag.options.xmax!=null){h=ah.series_u2p(ag.options.xmax)}else{if(Z!=null){if(w.type(Z)=="number"){h=ah.series_u2p(ah.max-Z)}else{if(w.type(Z)=="string"){h=ah.series_u2p(ah.max)-parseFloat(Z)}}}}var f=j.axes[ag.options.yaxis],aj,W,i=j.axes[ag.options.xaxis].series_u2p(ag.options.x),aa=ag.options.yminOffset||ag.options.yOffset,ae=ag.options.ymaxOffset||ag.options.yOffset;if(ag.options.ymin!=null){aj=f.series_u2p(ag.options.ymin)}else{if(aa!=null){if(w.type(aa)=="number"){aj=f.series_u2p(f.min-aa)}else{if(w.type(aa)=="string"){aj=f.series_u2p(f.min)-parseFloat(aa)}}}}if(ag.options.ymax!=null){W=f.series_u2p(ag.options.ymax)}else{if(ae!=null){if(w.type(ae)=="number"){W=f.series_u2p(f.max+ae)}else{if(w.type(ae)=="string"){W=f.series_u2p(f.max)+parseFloat(ae)}}}}if(h!=null&&a!=null&&W!=null&&aj!=null){ag.gridStart=[a,aj];ag.gridStop=[h,W];this.canvas._ctx.fillStyle=ag.options.color;this.canvas._ctx.fillRect(a,aj,h-a,W-aj)}break;default:break}}}}};w.jqplot.CanvasOverlay.postPlotDraw=function(){var a=this.plugins.canvasOverlay;if(a&&a.highlightCanvas){a.highlightCanvas.resetCanvas();a.highlightCanvas=null}a.canvas=new w.jqplot.GenericCanvas();this.eventCanvas._elem.before(a.canvas.createElement(this._gridPadding,"jqplot-overlayCanvas-canvas",this._plotDimensions,this));a.canvas.setContext();if(!a.deferDraw){a.draw(this)}var b=document.createElement("div");a._tooltipElem=w(b);b=null;a._tooltipElem.addClass("jqplot-canvasOverlay-tooltip");a._tooltipElem.css({position:"absolute",display:"none"});this.eventCanvas._elem.before(a._tooltipElem);this.eventCanvas._elem.bind("mouseleave",{elem:a._tooltipElem},function(c){c.data.elem.hide()});var a=null};function p(i,b,a,c){var g=i.plugins.canvasOverlay;var d=g._tooltipElem;var e=b.options,f,h;d.html(w.jqplot.sprintf(e.tooltipFormatString,c[0],c[1]));switch(e.tooltipLocation){case"nw":f=a[0]+i._gridPadding.left-d.outerWidth(true)-e.tooltipOffset;h=a[1]+i._gridPadding.top-e.tooltipOffset-d.outerHeight(true);break;case"n":f=a[0]+i._gridPadding.left-d.outerWidth(true)/2;h=a[1]+i._gridPadding.top-e.tooltipOffset-d.outerHeight(true);break;case"ne":f=a[0]+i._gridPadding.left+e.tooltipOffset;h=a[1]+i._gridPadding.top-e.tooltipOffset-d.outerHeight(true);break;case"e":f=a[0]+i._gridPadding.left+e.tooltipOffset;h=a[1]+i._gridPadding.top-d.outerHeight(true)/2;break;case"se":f=a[0]+i._gridPadding.left+e.tooltipOffset;h=a[1]+i._gridPadding.top+e.tooltipOffset;break;case"s":f=a[0]+i._gridPadding.left-d.outerWidth(true)/2;h=a[1]+i._gridPadding.top+e.tooltipOffset;break;case"sw":f=a[0]+i._gridPadding.left-d.outerWidth(true)-e.tooltipOffset;h=a[1]+i._gridPadding.top+e.tooltipOffset;break;case"w":f=a[0]+i._gridPadding.left-d.outerWidth(true)-e.tooltipOffset;h=a[1]+i._gridPadding.top-d.outerHeight(true)/2;break;default:f=a[0]+i._gridPadding.left-d.outerWidth(true)-e.tooltipOffset;h=a[1]+i._gridPadding.top-e.tooltipOffset-d.outerHeight(true);break}d.css("left",f);d.css("top",h);if(e.fadeTooltip){d.stop(true,true).fadeIn(e.tooltipFadeSpeed)}else{d.show()}d=null}function s(g,b,B,c){var e=g[0];var f=g[1];var h=Math.round(B[0]);var i=Math.round(B[1]);var l=Math.round(b[0]);var m=Math.round(b[1]);var a=Math.sqrt(Math.pow(h-l,2)+Math.pow(i-m,2));var d=c*a;var j=Math.abs((l-h)*(f-i)-(m-i)*(e-h));var k=(j<d)?true:false;return k}function t(g,b,a,c){var d=g[0];var e=g[1];var h=Math.round(a[0]);var i=Math.round(a[1]);var k=Math.round(b[0]);var l=Math.round(b[1]);var f;if(h>k){f=h;h=k;k=f}if(i>l){f=i;i=l;l=f}var j=(d>=h&&d<=k&&e>=i&&e<=l);return j}function z(f,i,a,e,h){var g=h.plugins.canvasOverlay;var j=g.objects;var m=j.length;var k,d=false;var b;for(var l=0;l<m;l++){k=j[l];if(k.options.showTooltip){var c;if(k.type==="rectangle"){c=t([i.x,i.y],k.gridStart,k.gridStop,k.tooltipWidthFactor)}else{c=s([i.x,i.y],k.gridStart,k.gridStop,k.tooltipWidthFactor)}a=[h.axes[k.options.xaxis].series_p2u(i.x),h.axes[k.options.yaxis].series_p2u(i.y)];if(c&&g.highlightObjectIndex==null){switch(k.type){case"line":p(h,k,[i.x,i.y],a);break;case"horizontalLine":case"dashedHorizontalLine":p(h,k,[i.x,k.gridStart[1]],[a[0],k.options.y]);break;case"verticalLine":case"dashedVerticalLine":p(h,k,[k.gridStart[0],i.y],[k.options.x,a[1]]);break;case"rectangle":p(h,k,[k.gridStart[0],i.y],[k.options.x,a[1]]);break;default:break}g.highlightObjectIndex=l;d=true;break}else{if(c&&g.highlightObjectIndex!==l){b=g._tooltipElem;if(k.fadeTooltip){b.fadeOut(k.tooltipFadeSpeed)}else{b.hide()}switch(k.type){case"line":p(h,k,[i.x,i.y],a);break;case"horizontalLine":case"dashedHorizontalLine":p(h,k,[i.x,k.gridStart[1]],[a[0],k.options.y]);break;case"verticalLine":case"dashedVerticalLine":p(h,k,[k.gridStart[0],i.y],[k.options.x,a[1]]);break;case"rectangle":p(h,k,[k.gridStart[0],i.y],[k.options.x,a[1]]);break;default:break}g.highlightObjectIndex=l;d=true;break}else{if(c){switch(k.type){case"line":p(h,k,[i.x,i.y],a);break;case"horizontalLine":case"dashedHorizontalLine":p(h,k,[i.x,k.gridStart[1]],[a[0],k.options.y]);break;case"verticalLine":case"dashedVerticalLine":p(h,k,[k.gridStart[0],i.y],[k.options.x,a[1]]);break;case"rectangle":p(h,k,[k.gridStart[0],i.y],[k.options.x,a[1]]);break;default:break}d=true;break}}}}}if(!d&&g.highlightObjectIndex!==null){b=g._tooltipElem;k=g.getObject(g.highlightObjectIndex);if(k.fadeTooltip){b.fadeOut(k.tooltipFadeSpeed)}else{b.hide()}g.highlightObjectIndex=null}}w.jqplot.postInitHooks.push(w.jqplot.CanvasOverlay.postPlotInit);w.jqplot.postDrawHooks.push(w.jqplot.CanvasOverlay.postPlotDraw);w.jqplot.eventListenerHooks.push(["jqplotMouseMove",z])})(jQuery);