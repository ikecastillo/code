var ChartUtil=function(){var a="Story Points";this.storyPointField=function(b){getFieldID};this.sprintField};var getFields=function(b){if(!b){return null}var a=b;var c=AJS.$.ajax({type:"GET",url:a,contentType:"application/json",async:false}).responseText;return JSON.parse(c)};var getFieldid=function(c,a){var b="-----";for(_i=0,_len=c.length;_i<_len;_i++){if(c[_i].name==a){return c[_i].id}}return b};function sortObj(b,a){return b.sort(function(e,d){var c=e[a];var f=d[a];return((c<f)?-1:((c>f)?1:0))})}var chartdatasort=function(){var a=[{name:"Sprint 1",startdate:10/1/2013,enddate:"11/1/2012",committed:200,Completed:150},{name:"Sprint 3",startdate:12/1/2012,enddate:"11/1/2012",committed:40,Completed:20},{name:"Sprint 2",startdate:11/1/2012,enddate:"11/1/2012",committed:100,Completed:80}];console.log(JSON.stringify(a));c2=sortObj(a,"committed");console.log(JSON.stringify(c2))};var AddedAfterSprintStart=function(h,d){for(var f=0,b=h.histories.length;f<b;f++){var i=h.histories[f];if(new Date(i.created)>new Date(d[2])){for(var e=0,a=i.items.length;e<a;e++){item=i.items[e];if(item.field=="Sprint"){var c=(item.from==null)?"".split(","):item.from.split(",");var j=(item.to==null)?"".split(","):item.to.split(",");for(var g=0;g<j.length;g++){var k=false;for(var l=0;l<c.length;l++){if(j[g]==c[l]){k=true;break}}if(!k&&j[g].replace(/^\s\s*/,"").replace(/\s\s*$/,"")==d[5]){return true}}}}}}return false};var isIssueDone=function(b){var a=["Closed","Resolved","Done"];for(_i=0,_len=a.length;_i<_len;_i++){if(b.replace(/^\s+|\s+$/g,"")==a[_i]){return true}}return false};var getSP=function(a){var b=a.fields.customfield_10003;if(b==null){b=0}return b};var getSprints=function(a){var b=a.fields.customfield_10006;var d=new Array();if(b instanceof Array&&b!=null){for(var c=0;c<b.length;c++){d.push(getSprintArray(b[c]))}}return d};var getSprintArray=function(b){var b=b.substring(b.indexOf("[")+1,b.indexOf("]")).split(",");for(var c=0,a=b.length;c<a;c++){b[c]=b[c].substring(b[c].indexOf("=")+1)}return b};var getChartObj=function(m){var g=[];var b,l;for(var h=0,j=m.issues.length;h<j;h++){l=m.issues[h];b=getSprints(l);var e=[];for(_j=0;_j<b.length;_j++){var n=-1;e=b[_j];var c=(_j==(b.length-1));var k=AddedAfterSprintStart(l.changelog,e);var a=isIssueDone(l.fields.status.name);for(var d=0;d<g.length;d++){if(g[d].id==e[5]){n=d;break}}if(n==-1){var f={};f.name=e[0];f.startdate=e[2];f.enddate=e[3];f.id=Number(e[5]);f.committed=0;f.completed=0;if(!k){f.committed=getSP(l)}if(a&&c){f.completed=getSP(l)}g.push(f)}else{if(!k){g[n]["committed"]=g[n]["committed"]+getSP(l)}if(a&&c){g[n]["completed"]=g[n]["completed"]+getSP(l)}}}}sortObj(g,"id");return g};var dateFormat=function(){var c=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,a=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,b=function(g,f){g=String(g);f=f||2;while(g.length<f){g="0"+g}return g};return function(q,E,j){var D=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(q)=="[object String]"&&!/\d/.test(q)){E=q;q=undefined}q=q?new Date(q):new Date;if(isNaN(q)){throw SyntaxError("invalid date")}E=String(D.masks[E]||E||D.masks["default"]);if(E.slice(0,4)=="UTC:"){E=E.slice(4);j=true}var B=j?"getUTC":"get",w=q[B+"Date"](),n=q[B+"Day"](),z=q[B+"Month"](),r=q[B+"FullYear"](),e=q[B+"Hours"](),x=q[B+"Minutes"](),C=q[B+"Seconds"](),k=q[B+"Milliseconds"](),t=j?0:q.getTimezoneOffset(),A={d:w,dd:b(w),ddd:D.i18n.dayNames[n],dddd:D.i18n.dayNames[n+7],m:z+1,mm:b(z+1),mmm:D.i18n.monthNames[z],mmmm:D.i18n.monthNames[z+12],yy:String(r).slice(2),yyyy:r,h:e%12||12,hh:b(e%12||12),H:e,HH:b(e),M:x,MM:b(x),s:C,ss:b(C),l:b(k,3),L:b(k>99?Math.round(k/10):k),t:e<12?"a":"p",tt:e<12?"am":"pm",T:e<12?"A":"P",TT:e<12?"AM":"PM",Z:j?"UTC":(String(q).match(a)||[""]).pop().replace(d,""),o:(t>0?"-":"+")+b(Math.floor(Math.abs(t)/60)*100+Math.abs(t)%60,4),S:["th","st","nd","rd"][w%10>3?0:(w%100-w%10!=10)*w%10]};return E.replace(c,function(f){return f in A?A[f]:f.slice(1,f.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.getWholeDays=function(){return Math.floor(this/(1000*60*60*24))};function dateDiff(a,b){return b.getWholeDays()-a.getWholeDays()};