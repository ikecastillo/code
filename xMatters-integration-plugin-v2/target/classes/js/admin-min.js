AJS.toInit(function(){Mapper.getAllMappings();EventManager.getAllEventConfigs();HipChatRoomConfigurator.getAllHipChatConfigs();function g(){AJS.$.ajax({url:"/rest/xmatter-integration/1.0/xconfig",dataType:"json",success:function(h){AJS.$("#xmattersuid").attr("value",h.xmattersUid);AJS.$("#xmatterspwd").attr("value",h.xmattersPwd);AJS.$("#xmattersinterval").attr("value",h.xmattersInterval);AJS.$("#xmattersjiraemailid").attr("value",h.jiraAdminEmail);AJS.$("#xmattershipchattoken").attr("value",h.xmattersHipchattoken)}})}function c(){AJS.$.ajax({url:"/rest/xmatter-integration/1.0/xconfig",type:"PUT",contentType:"application/json",data:'{"jiraAdminEmail": "'+AJS.$("#xmattersjiraemailid").attr("value")+'","xmattersInterval": "'+AJS.$("#xmattersinterval").attr("value")+'", "xmattersUid": "'+AJS.$("#xmattersuid").attr("value")+'","xmattersPwd": "'+AJS.$("#xmatterspwd").attr("value")+'","xmattersHipchattoken": "'+AJS.$("#xmattershipchattoken").attr("value")+'"}',processData:false})}g();AJS.$("#admin2").submit(function(h){h.preventDefault();c();JIRA.Messages.showSuccessMsg("Plugin Configuration Saved Successfully!")});AJS.$("#mapping-button").click(function(){AJS.log("Mapping dialog pops up");AJS.dialog2("#mapping-dialog").show();AJS.$(".error").html("");AJS.$("#jiraField > option:eq(0)").prop("selected",true);AJS.$("#xMattersField").val("");var i=AJS.I18n.getText("xMatters.admin.mappingform.defaultProjectKey");var h=AJS.I18n.getText("xMatters.admin.mappingform.defaultIssueType");AJS.log("Project Key used : "+i);AJS.log("Issue Type used : "+h);b(i,h)});AJS.$("#mapping-dialog-cancel-link").click(function(h){h.preventDefault();AJS.dialog2("#mapping-dialog").hide();AJS.log("Mapping dialog hides")});AJS.$("#mapping-dialog-add-button").click(function(){if(e()){Mapper.addMapping();AJS.dialog2("#mapping-dialog").hide()}});AJS.$(".deleteMapping").live("click",function(){var i=AJS.$(this).closest("tr");var h=[];AJS.$(this).closest("tr").find("td").each(function(){h.push(AJS.$(this).text())});AJS.log("Field to delete for JIRA "+h[0]);AJS.log("Field to delete for xMatters "+h[1]);AJS.log("Delete Mapping dialog pops up");AJS.dialog2("#delete-mapping-dialog").show();AJS.$("#jirafieldconf").text(h[0]);AJS.$("#xmattersfieldconf").text(h[1])});AJS.$("#mapping-dialog-delete-cancel-link").click(function(h){h.preventDefault();AJS.dialog2("#delete-mapping-dialog").hide();AJS.log("Delete Mapping dialog hides")});AJS.$("#mapping-dialog-delete-button").click(function(){AJS.log("Making an AJAX call to delete "+AJS.$("#jirafieldconf").text()+" -> "+AJS.$("#xmattersfieldconf").text());Mapper.removeMapping(AJS.$("#jirafieldconf").text(),AJS.$("#xmattersfieldconf").text());AJS.dialog2("#delete-mapping-dialog").hide()});AJS.$("#event-config-button").click(function(){AJS.log("Event dialog pops up");AJS.dialog2("#event-dialog").show();AJS.$(".error").html("");AJS.$(".mandatoryevtField").val("");AJS.$(".optionalFieldEvt").val("")});AJS.$("#event-dialog-cancel-link").click(function(h){h.preventDefault();AJS.dialog2("#event-dialog").hide();AJS.log("Event dialog hides")});AJS.$("#event-dialog-add-button").click(function(){if(f()){EventManager.addEventConfig();AJS.dialog2("#event-dialog").hide()}});AJS.$(".deleteEvent").live("click",function(){var i=AJS.$(this).closest("tr");var h=[];AJS.$(this).closest("tr").find("td").each(function(){h.push(AJS.$(this).text())});AJS.log("Delete Mapping dialog pops up");AJS.dialog2("#delete-event-dialog").show();AJS.$("#formapiidconf").text(h[0]);AJS.$("#xmattersFormconf").text(h[1]);AJS.$("#xmattersformwsconf").text(h[2]);AJS.$("#responsecodeavconf").text(h[3]);AJS.$("#responsecodenotavconf").text(h[4])});AJS.$("#event-dialog-delete-cancel-link").click(function(h){h.preventDefault();AJS.dialog2("#delete-event-dialog").hide();AJS.log("Delete Event dialog hides")});AJS.$("#event-dialog-delete-button").click(function(){AJS.log("Making an AJAX call to delete xmatters event config with form API ID "+AJS.$("#formapiidconf").text());EventManager.removeEventConfig(AJS.$("#formapiidconf").text(),AJS.$("#xmattersFormconf").text(),AJS.$("#xmattersformwsconf").text(),AJS.$("#responsecodeavconf").text(),AJS.$("#responsecodenotavconf").text());AJS.dialog2("#delete-event-dialog").hide()});AJS.$("#hipchat-config-button").click(function(){AJS.log("Hipchat config dialog pops up");AJS.dialog2("#hipchat-dialog").show();AJS.$(".error").html("");AJS.$(".mandatoryhcField").val("");var h=AJS.I18n.getText("xMatters.admin.mappingform.defaultProjectKey");a(h)});AJS.$("#hipchatconfig-dialog-cancel-link").click(function(h){h.preventDefault();AJS.dialog2("#hipchat-dialog").hide();AJS.log("Hipchat dialog hides")});AJS.$("#hipchatconfig-dialog-add-button").click(function(){if(d()){HipChatRoomConfigurator.addHipChatConfig();AJS.dialog2("#hipchat-dialog").hide()}});AJS.$(".deleteHCConfig").live("click",function(){var i=AJS.$(this).closest("tr");var h=[];AJS.$(this).closest("tr").find("td").each(function(){h.push(AJS.$(this).text())});AJS.log("Delete Hipchat dialog pops up");AJS.dialog2("#delete-hipchat-dialog").show();AJS.$("#sollinemgmtconf").text(h[0]);AJS.$("#hipchatroomurlconf").text(h[1])});AJS.$("#hipchat-dialog-delete-cancel-link").click(function(h){h.preventDefault();AJS.dialog2("#delete-hipchat-dialog").hide();AJS.log("Delete Hipchat dialog hides")});AJS.$("#hipchat-dialog-delete-button").click(function(){AJS.log("Making an AJAX call to delete hipchat config for severity "+AJS.$("#sollinemgmtconf").text());HipChatRoomConfigurator.removeHipChatConfig(AJS.$("#sollinemgmtconf").text(),AJS.$("#hipchatroomurlconf").text());AJS.dialog2("#delete-hipchat-dialog").hide()});function b(i,h){AJS.$.ajax({url:"/rest/xmatter-integration/1.0/jirafields/"+i+"/"+h+".json",dataType:"json",success:function(o){AJS.log("custom fields->"+o.csvFields);var m=o.csvFields.split(",");var j=AJS.$("#jiraField");AJS.$("option",j).not(":eq(0)").remove();for(var l=0;l<m.length;l++){var n=m[l];var k=AJS.$("<option/>").attr("value",n).text(n);j.append(k)}}})}function e(){var h,i;AJS.$(".error").html("");var j=AJS.$("#xMattersField").val().trim();if(AJS.$("#jiraField option:selected").text()=="Select"){i=AJS.I18n.getText("xmatters.admin.mappingform.dialog.errorjiraField")}else{if(!j){h=AJS.I18n.getText("xmatters.admin.mappingform.dialog.errorxMattersField")}}if(h){AJS.$("#xMattersField").focus().siblings(".error").html(h);return false}else{if(i){AJS.$("#jiraField").focus().siblings(".error").html(i);return false}}return true}function f(){var h=true;AJS.$(".error").html("");AJS.$(".mandatoryevtField").each(function(){if(!AJS.$(this).val()){AJS.log("Found a blank field, cant save");AJS.$(this).focus().siblings(".error").html("This field cannot be left blank");h=false}});return h}function d(){var h=true;AJS.$(".error").html("");AJS.$(".mandatoryhcField").each(function(){if(!AJS.$(this).val()){AJS.log("Found a blank field, cant save");AJS.$(this).focus().siblings(".error").html("This field cannot be left blank");h=false}});return h}function a(h){AJS.$.ajax({url:AJS.params.baseURL+"/rest/xmatter-integration/1.0/getSolutionGroups",type:"GET",contentType:"application/json",data:{projectkey:h},async:false,success:function(m){var n=AJS.$("#sollinemgmt");for(var k=0;k<m.length;k++){var l=m[k].value;var j=AJS.$("<option/>").attr("value",l).text(l);n.append(j)}}})}});