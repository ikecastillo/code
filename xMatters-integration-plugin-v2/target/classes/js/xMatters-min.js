AJS.$(function(){var b=function(){if(JIRA.IssueNavigator.isNavigator()){return JIRA.IssueNavigator.getSelectedIssueKey()}else{return AJS.$.trim(AJS.$("#key-val").text())}};var a=function(){var c=b();if(c){return c.match("[A-Z]*")[0]}};JIRA.Dialogs.scheduleIssue=new JIRA.FormDialog({id:"xMatters-dialog",trigger:"a.issueaction-xMatters-issue",ajaxOptions:JIRA.Dialogs.getDefaultAjaxOptions,onSuccessfulSubmit:function(){var h="https://cm.hipchat.com";var f=0;AJS.$.ajax({url:"/rest/xmatter-integration/1.0/getroomdetails.json",type:"GET",contentType:"application/json",data:{issuekey:JIRA.Issue.getIssueKey()},async:false,success:function(j){var k=j;var i=AJS.$.parseJSON(k.release).id;AJS.log("JSON RESPONSE RELEASE ID "+i);if(i){f=i}AJS.log("ROOM NO IS "+f)},error:function(){AJS.log("ERRORED OUT , ROOM NO IS SET TO 0");f=0}});console.log("HIP CHAT ROOM NUMBER FROM DOM IS "+f);console.log("HIPCHAT SERVER URL FROM DOM IS "+h);var d=1;var c=["",""];if(AJS.$("#radioButtonOne").is(":checked")||AJS.$("#radioButtonTwo").is(":checked")){d=AJS.$(".subconfbridge:checked").size();c=AJS.$(".subconfbridge:checked").map(function(){return this.value}).get();AJS.log("Checked Values 1"+c[0]);AJS.log("Checked Values 2"+c[1]);var e=AJS.$(".subconfbridge:checked").size();AJS.log("Sub conference bridges selected for type external are "+e);if(e==0){JIRA.Messages.showErrorMsg("Please select atleast one of the following options 1) Management or 2)Technical and try again!");d=e}}AJS.log("AJAX CALLS TO BE MADE : "+d);var g=false;if(d>=1){AJS.log("ajaxCallCounter "+d);AJS.$.ajax({url:AJS.params.baseURL+"/rest/xmatter-integration/1.0/xMatters",type:"GET",contentType:"application/json",data:{issueKey:JIRA.Issue.getIssueKey(),confBridge:AJS.$("#radioButtonOne").is(":checked"),nonConfBridge:AJS.$("#radioButtonTwo").is(":checked"),internalConfBridge:AJS.$("#radioButtonThree").is(":checked"),internalNonConfBridge:AJS.$("#radioButtonFour").is(":checked"),restCallCounter:0,totalRestCalls:d,confBridgeType:c[0],firstRowAdded:false,technicalhipchatroomno:f,hipChatServerURL:h},async:false,success:function(i){AJS.log("response 1 :"+i);if(i.status==="Validation Success"){JIRA.Messages.showSuccessMsg(AJS.I18n.getText("xMatters.success.issue",JIRA.Issue.getIssueKey()));g=true}else{AJS.log("Showing Error message");JIRA.Messages.showErrorMsg(i.message);AJS.log("Error message shown")}}})}if(d===2&&g){AJS.log("ajaxCallCounter 2 "+d);AJS.$.ajax({url:AJS.params.baseURL+"/rest/xmatter-integration/1.0/xMatters",type:"GET",contentType:"application/json",data:{issueKey:JIRA.Issue.getIssueKey(),confBridge:AJS.$("#radioButtonOne").is(":checked"),nonConfBridge:AJS.$("#radioButtonTwo").is(":checked"),internalConfBridge:AJS.$("#radioButtonThree").is(":checked"),internalNonConfBridge:AJS.$("#radioButtonFour").is(":checked"),restCallCounter:1,totalRestCalls:d,confBridgeType:c[1],firstRowAdded:true},async:false,success:function(i){AJS.log("response 2 :"+i);if(i.status==="Validation Success"){JIRA.Messages.showSuccessMsg(AJS.I18n.getText("xMatters.success.issue",JIRA.Issue.getIssueKey()))}else{AJS.log("Showing Error message");JIRA.Messages.showErrorMsg(i.message);AJS.log("Error message shown")}}})}},onDialogFinished:function(){},autoClose:true})});