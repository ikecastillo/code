AJS.toInit(function(){JIRASDFMMapper.getAllMappings();function a(){AJS.$.ajax({url:"/rest/jirasdfm/1.0/jirasdfmadminconfig",type:"PUT",contentType:"application/json",data:'{"serviceDeskUserId": "'+AJS.$("#jirasdfmuid").attr("value")+'", "serviceDeskPwd": "'+AJS.$("#jirasdfmpwd").attr("value")+'", "serviceDeskURL": "'+AJS.$("#jirasdfmSDURL").attr("value")+'"}',processData:false})}AJS.$("#jirasdfmadmin2").submit(function(b){b.preventDefault();a();JIRA.Messages.showSuccessMsg("Plugin Configuration Saved Successfully!")});AJS.$("#jirasdfm-mapping-button").click(function(){AJS.log("Mapping dialog pops up");AJS.dialog2("#jirasdfm-mapping-dialog").show();AJS.$(".error").html("");AJS.$("#jiracustField > option:eq(0)").prop("selected",true);AJS.$("#sdcustField > option:eq(0)").prop("selected",true);var c="CHG";var b="Change";AJS.log("Project Key used : "+c);AJS.log("Issue Type used : "+b);populateJiraCustomFields(c,b);populateServiceDeskCustomFields()});AJS.$("#jirasdfmmapping-dialog-cancel-link").click(function(b){b.preventDefault();AJS.dialog2("#jirasdfm-mapping-dialog").hide();AJS.log("Mapping dialog hides")});AJS.$("#jirasdfmmapping-dialog-add-button").click(function(){if(jiraandSDMappingDialogFieldsNotEmpty()){JIRASDFMMapper.addMapping();AJS.dialog2("#jirasdfm-mapping-dialog").hide()}});AJS.$(".jirasdfmdeleteMapping").live("click",function(){var c=AJS.$(this).closest("tr");var b=[];AJS.$(this).closest("tr").find("td").each(function(){b.push(AJS.$(this).text())});AJS.log("Field to delete for JIRA "+b[0]);AJS.log("Field to delete for Service Desk "+b[1]);AJS.log("Delete Mapping dialog pops up");AJS.dialog2("#jirasdfm-delete-mapping-dialog").show();AJS.$("#jirafieldconf").text(b[0]);AJS.$("#jirasdfmfieldconf").text(b[1]);AJS.$("#jirasdfmfieldidconf").text(b[2])});AJS.$("#jirasdfmmapping-dialog-delete-cancel-link").click(function(b){b.preventDefault();AJS.dialog2("#jirasdfm-delete-mapping-dialog").hide();AJS.log("Delete Mapping dialog hides")});AJS.$("#jirasdfmmapping-dialog-delete-button").click(function(){AJS.log("Making an AJAX call to delete "+AJS.$("#jirafieldconf").text()+" -> "+AJS.$("#jirasdfmfieldconf").text());JIRASDFMMapper.removeMapping(AJS.$("#jirafieldconf").text(),AJS.$("#jirasdfmfieldconf").text(),AJS.$("#jirasdfmfieldidconf").text());AJS.dialog2("#jirasdfm-delete-mapping-dialog").hide()})});function populateJiraCustomFields(b,a){AJS.$.ajax({url:"/rest/jirasdfm/1.0/jirafields/"+b+"/"+a+".json",dataType:"json",success:function(h){AJS.log("custom fields->"+h.csvFields);var f=h.csvFields.split(",");var c=AJS.$("#jiracustField");AJS.$("option",c).not(":eq(0)").remove();for(var e=0;e<f.length;e++){var g=f[e];var d=AJS.$("<option/>").attr("value",g).text(g);c.append(d)}}})}function populateServiceDeskCustomFields(){AJS.log("Getting initial Set up fields to populate for the second dropdown");AJS.$.ajax({url:"/rest/jirasdfm/1.0/getAllServiceDeskFields",dataType:"json",success:function(e){var a=AJS.$("#sdcustField");AJS.$("option",a).not(":eq(0)").remove();for(var b=0;b<e.length;b++){var d=e[b].fieldName;var c=e[b].fieldId;var f=AJS.$("<option/>").attr({value:d,id:c}).text(d);a.append(f)}}})}function jiraandSDMappingDialogFieldsNotEmpty(){var c=AJS.$("#jiracustField option:selected").text();var b=AJS.$("#sdcustField option:selected").text();var a=true;if(c=="Select"){AJS.$("#jiracustFielderror").html("Please select a JIRA ITSM field");a=false}if(b=="Select"){AJS.$("#sdcustFielderror").html("Please select a JIRA Service Desk field");a=false}return a};